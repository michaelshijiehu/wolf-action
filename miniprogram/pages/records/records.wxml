<!--miniprogram/pages/records/records.wxml-->
<view class="container">
  <view wx:if="{{records && records.length > 0}}" class="record-list">
    <view class="record-item" wx:for="{{records}}" wx:for-item="record" wx:key="_id" bindtap="goToRecordDetail" data-id="{{record._id}}">
      <view class="record-header">
        <text class="record-date">{{record.record_date}}</text>
        <text class="record-winner {{record.winner === 'good' ? 'winner-good' : 'winner-werewolf'}}">
          {{record.winner === 'good' ? 'å¥½äººèƒœåˆ©' : 'ç‹¼äººèƒœåˆ©'}}
        </text>
      </view>
      <view class="record-players">
        <view class="player-info" wx:for="{{record.players}}" wx:for-item="player" wx:key="seat">
          <image class="player-avatar" src="{{player.avatar_url || '../../images/icons/avatar.png'}}"></image>
          <text class="player-name">{{player.nickname}}</text>
          <text class="player-role">{{utils.getRoleName(player.role)}}</text>
        </view>
      </view>
      <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… ></text>
    </view>
    <view wx:if="{{hasMoreRecords}}" class="load-more" bindtap="loadMoreRecords">åŠ è½½æ›´å¤š</view>
  </view>
  <view wx:else class="empty-state">
    <view class="empty-icon-box">
      <text class="empty-icon">ğŸ“œ</text>
    </view>
    <text class="empty-title">æš‚æ— æˆ˜ç»©</text>
    <text class="empty-desc">ä½ çš„ä¼ å¥‡æ•…äº‹ï¼Œå°†ä»ä¸‹ä¸€å±€å¼€å§‹ä¹¦å†™</text>
    <button class="create-room-btn" bindtap="goToHome">å»åˆ›å»ºæˆ¿é—´</button>
  </view>
</view>
<wxs module="utils">
module.exports.getRoleName = function(role) {
  var map = {
    'werewolf': 'ç‹¼äºº',
    'villager': 'æ‘æ°‘',
    'seer': 'é¢„è¨€å®¶',
    'witch': 'å¥³å·«',
    'hunter': 'çŒäºº',
    'idiot': 'ç™½ç—´',
    'guard': 'å®ˆå«',
    'cupid': 'ä¸˜æ¯”ç‰¹',
    'unknown': 'éšè—'
  };
  return map[role] || role;
}
</wxs>